<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title>Evara - eCommerce HTML Template</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/user/assets/imgs/theme/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


      <!-- CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    
    <!-- Include SweetAlert CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">


    <!-- Template CSS -->
    <link rel="stylesheet" href="/user/assets/css/main.css?v=3.4">
    <style>
      

      .card-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card-header h5 {
            margin: 0;
        }
        .invoice-header button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
        .invoice-header button:hover {
            background-color: #45a049;
        }
        .address-card {
                margin-bottom: 20px;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f8f9fa;
            }
            .address-card h5 {
                margin-bottom: 15px;
            }
      </style>
</head>

<body>
    <header class="header-area header-style-5">
        <!-- <div class="header-top header-top-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="row align-items-center"> -->
                    <!-- <div class="col-xl-3 col-lg-4">
                        <div class="header-info">
                            <ul>
                                <li><i class="fi-rs-smartphone"></i> <a href="#">(+01) - 2345 - 6789</a></li>
                                <li><i class="fi-rs-marker"></i><a  href="page-contact.html">Our location</a></li>
                            </ul>
                        </div>
                    </div> -->
                    <!-- <div class="col-xl-6 col-lg-4"> -->
                        <!-- <div class="text-center">
                            <div id="news-flash" class="d-inline-block">
                                <ul>
                                    <li>Get great devices up to 50% off <a href="shop-grid-right.html">View details</a></li>
                                    <li>Supper Value Deals - Save more with coupons</li>
                                    <li>Trendy 25silver jewelry, save up 35% off today <a href="shop-grid-right.html">Shop now</a></li>
                                </ul>
                            </div>
                        </div>
                    </div> -->
                    <!-- <div class="col-xl-3 col-lg-4">
                        <div class="header-info header-info-right">
                            <ul>
                                <li>
                                    <a class="language-dropdown-active" href="#"> <i class="fi-rs-world"></i> English <i class="fi-rs-angle-small-down"></i></a>
                                    <ul class="language-dropdown">
                                        <li><a href="#"><img src="/user/assets/imgs/theme/flag-fr.png" alt="">Français</a></li>
                                        <li><a href="#"><img src="/user/assets/imgs/theme/flag-dt.png" alt="">Deutsch</a></li>
                                        <li><a href="#"><img src="/user/assets/imgs/theme/flag-ru.png" alt="">Pусский</a></li>
                                    </ul>
                                </li>
                                <li><i class="fi-rs-user"></i><a href="page-login-register.html">Log In / Sign Up</a></li>
                            </ul>
                        </div>
                    </div> -->
                <!-- </div>
            </div>
        </div> -->
        <div class="header-bottom sticky-bar sticky-white-bg">
            <div class="container">
                <div class="header-wrap header-space-between position-relative">
                    <div class="logo logo-width-1">
                        <!-- <a href="/">Shopiz</a> -->  
                        <a href="#"><img src="/user/assets/imgs/theme/logo.svg" alt="logo"></a>

                        <!-- <a href="index.html"><img src="/user/assets/imgs/theme/logo.svg" alt="logo"></a> -->
                    </div>
                    <div class="main-menu main-menu-grow main-menu-padding-1 main-menu-lh-1 main-menu-mrg-1 hm3-menu-padding d-none d-lg-block hover-boder">
                        <nav>
                            <ul>
                                <li><a class="active" href="/user_Home1">Home <i ></i></a>
                                  
                                </li>
                                <li><a href="/loadShop">Shop <i ></i></a>
                                    
                                </li>
                                
                                </li>
                            </ul>
                        </nav>
                    </div>
                    
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="/user_Home1">Home</a>
                    <span><a href="/orders">Order</a></span>
                    <span>Order-Details</span>
                </div>
            </div>
        </div>
        
      
        <!-- <section class="pt-80 pb-100">
            <div class="container">
                <div class="row">
               
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Your Orders</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Product</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                                <th>Product Price</th>
                                                <th>Total</th>
                                                <th>Payment Method</th>
                                                <th>Address</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="image product-thumbnail">
                                                    <img src="/uploads/<%= order.productId.images[0] %>" alt="Product Image">
                                                </td>
                                                <td>
                                                    <%= new Date(order.date).toLocaleDateString('en-US', {
                                                        weekday: 'short',
                                                        year: 'numeric',
                                                        month: 'short',
                                                        day: 'numeric'
                                                    }) %>
                                                </td>
                                                <td>
                                                    <% if (order.product_orderStatus === "cancelled") { %>
                                                        <span id="status-<%= order._id %>" class="text-danger">
                                                            <%= order.product_orderStatus %>
                                                        </span>
                                                    <% } else if (order.product_orderStatus === "pending" || order.product_orderStatus === "return") { %>
                                                        <span id="status-<%= order._id %>" class="text-warning">
                                                            <%= order.product_orderStatus %>
                                                        </span>
                                                    <% } else if (order.product_orderStatus === "completed") { %>
                                                        <span id="status-<%= order._id %>" class="text-success">
                                                            <%= order.product_orderStatus %>
                                                        </span>
                                                    <% } %>
                                                </td>
                                                <td>₹<%= order.productId.promo_Price %></td>
                                                <td>₹<%= order.productPrice %></td>
                                                <td><%= order.payment_method.method %></td>
                                                <td>
                                                    <% if (userOrder && userOrder.address && userOrder.address.length > 0) { %>
                                                        <% userOrder.address.forEach(function(addr) { %>
                                                            <div class="address-card">
                                                                <p>
                                                                    <strong><%= addr.name %></strong><br>
                                                                    <%= addr.street %>, <%= addr.city %><br>
                                                                    <%= addr.state %>, <%= addr.country %> - <%= addr.pincode %><br>
                                                                    <abbr title="Phone">P:</abbr> <%= addr.mobile %>
                                                                </p>
                                                            </div>
                                                        <% }) %>
                                                    <% } else { %>
                                                        <p>No shipping address found.</p>
                                                    <% } %>
                                                </td>
                                                <td>
                                                    <% if (order.product_orderStatus !== "cancelled" && order.product_orderStatus === "pending") { %>
                                                        <form id="cancelOrderForm" action="/cancel" method="POST">
                                                            <input type="hidden" name="orderId" value="<%= orderId %>">
                                                            <input type="hidden" name="productId" value="<%= order._id %>">
                                                            <button type="submit" id="cancelButton-<%= order._id %>" class="btn-small d-block btn-danger">
                                                                Cancel
                                                            </button>
                                                        </form>
                                                    <% } else if (order.product_orderStatus === "cancelled") { %>
                                                        <button class="btn btn-danger" disabled>
                                                            Cancelled
                                                        </button>
                                                    <% } %>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    
                </div>
            </div>
        </section> -->
       
        <section class="pt-80 pb-100">
            <div class="container">
                <div class="row">
                    <% if (order) { %>
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Your Orders</h5>
                                <div class="invoice-header">
                                    <% if (order.product_orderStatus === 'completed') { %>
                                        <a href="/order/invoice?orderId=<%= order._id %>">
                                            <button class="btn btn-primary">Invoice <span>&#128229;</span></button>
                                        </a>
                                    <% } else { %>
                                        <button class="btn btn-secondary disabled-button" disabled>Invoice <span>&#128229;</span></button>
                                    <% } %>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>OrderId</th>
                                                <th>Product</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                                <th>Product Price</th>
                                                <th>Quantity</th>
                                                <th>Delivery Charge</th>
                                                <th>Total</th>
                                                <th>Payment Method</th>
                                                <th>Address</th>
                                                <th>Coupon Used</th>
                                                <th>Offer Applied</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><%=orderId%></td>
                                                <td class="image product-thumbnail">
                                                    <img src="/uploads/<%= order.productId.images[0] %>" alt="Product Image">
                                                </td>
                                                <td>
                                                    <%= new Date(order.date).toLocaleDateString('en-US', {
                                                        weekday: 'short',
                                                        year: 'numeric',
                                                        month: 'short',
                                                        day: 'numeric'
                                                    }) %>
                                                </td>
                                                <td>
                                                    <% if (order.product_orderStatus === "cancelled") { %>
                                                        <span id="status-<%= order._id %>" class="text-danger">
                                                            <%= order.product_orderStatus %>
                                                        </span>
                                                    <% } else if (order.product_orderStatus === "pending" || order.product_orderStatus === "return") { %>
                                                        <span id="status-<%= order._id %>" class="text-warning">
                                                            <%= order.product_orderStatus %>
                                                        </span>
                                                    <% } else if (order.product_orderStatus === "completed") { %>
                                                        <span id="status-<%= order._id %>" class="text-success">
                                                            <%= order.product_orderStatus %>
                                                        </span>
                                                    <% } else if (order.product_orderStatus === "payment failed") { %>
                                                        <span id="status-<%= order._id %>" class="text-danger">
                                                            <%= order.product_orderStatus %>
                                                        </span>
                                                    <% } %>
                                                </td>
                                                <td>₹<%= order.productId.promo_Price %></td>
                                                <td><%=order.quantity%></td>
                                                <td>50</td>
                                                <td>₹<%= order.productPrice+50 %></td>
                                                <td><%= order.payment_method.method %></td>
                                                <td>
                                                    <% if (userOrder && userOrder.address && userOrder.address.length > 0) { %>
                                                        <% userOrder.address.forEach(function(addr) { %>
                                                            <div class="address-card">
                                                                <p>
                                                                    <strong><%= addr.name %></strong><br>
                                                                    <%= addr.street %>, <%= addr.city %><br>
                                                                    <%= addr.state %>, <%= addr.country %> - <%= addr.pincode %><br>
                                                                    <abbr title="Phone">P:</abbr> <%= addr.mobile %>
                                                                </p>
                                                            </div>
                                                        <% }) %>
                                                    <% } else { %>
                                                        <p>No shipping address found.</p>
                                                    <% } %>
                                                </td>
                                                <td>
                                                    <% if (couponDetails) { %>
                                                        <p><%= couponDetails.coupon_Code %> - <%= couponDetails.Offer_Percentage %>% off</p>
                                                    <% } else { %>
                                                        <p>No coupon used</p>
                                                    <% } %>
                                                </td>
                                                <td>
                                                    <% if (offerDetails) { %>
                                                        <p><%= offerDetails.offerName %> - <%= offerDetails.Discount %>% off</p>
                                                    <% } else { %>
                                                        <p>No offer applied</p>
                                                    <% } %>
                                                </td>
                                                <td>
                                                    <% if (order.product_orderStatus !== "cancelled" && order.product_orderStatus === "pending") { %>
                                                        <form id="cancelOrderForm" action="/cancel" method="POST">
                                                            <input type="hidden" name="orderId" value="<%= orderId %>">
                                                            <input type="hidden" name="productId" value="<%= order._id %>">
                                                            <button type="submit" id="cancelButton-<%= order._id %>" class="btn-small d-block btn-danger">
                                                                Cancel
                                                            </button>
                                                        </form>
                                                    <% } else if (order.product_orderStatus === "cancelled") { %>
                                                        <button class="btn btn-danger" disabled>
                                                            Cancelled
                                                        </button>
                                                    <% } %>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </section>
        
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cancelOrderForm = document.getElementById('cancelOrderForm');
    
            if (cancelOrderForm) {
                console.log("userOrder", `<%= orderId %>`);
    
                cancelOrderForm.addEventListener('submit', async function(event) {
                    event.preventDefault(); // Prevent the default form submission
    
                    Swal.fire({
                        title: 'Are you sure?',
                        text: "Do you really want to cancel this order?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, cancel it!'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            cancelOrder();
                        }
                    });
                });
    
                async function cancelOrder() {
                    console.log("function called");
                    const formData = new FormData(cancelOrderForm);
                    const orderId = formData.get('orderId');
                    const productId = formData.get('productId');
                    console.log("orderId", orderId);
                    console.log("productId", productId);
    
                    try {
                        const response = await fetch('/order/cancel', {
                            method: 'PUT',
                            body: JSON.stringify({ orderId, productId }),
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
    
                        const responseData = await response.json();
                        console.log("response data", responseData);
    
                        if (responseData.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success',
                                text: 'Order cancellation successful',
                                timer: 1500,
                                showConfirmButton: false
                            });
    
                            const statusElement = document.getElementById(`status-${productId}`);
                            const cancelButton = document.getElementById(`cancelButton-${productId}`);
    
                            if (statusElement) {
                                statusElement.textContent = 'Cancelled';
                                statusElement.classList.add('text-danger');
                            }
                            if (cancelButton) {
                                cancelButton.textContent = 'Cancelled';
                                cancelButton.classList.add('btn-danger');
                                cancelButton.disabled = true;
                            }
                        } else {
                            console.error('Error canceling order:', responseData.message);
                        }
                    } catch (error) {
                        console.error('Network error:', error);
                    }
                }
            } else {
                console.error('cancelOrderForm not found');
            }
        });
    </script>
    
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- Vendor JS-->
    <script src="/user/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="/user/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="/user/assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="/user/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="/user/assets/js/plugins/slick.js"></script>
    <script src="/user/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="/user/assets/js/plugins/wow.js"></script>
    <script src="/user/assets/js/plugins/jquery-ui.js"></script>
    <script src="/user/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="/user/assets/js/plugins/magnific-popup.js"></script>
    <script src="/user/assets/js/plugins/select2.min.js"></script>
    <script src="/user/assets/js/plugins/waypoints.js"></script>
    <script src="/user/assets/js/plugins/counterup.js"></script>
    <script src="/user/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="/user/assets/js/plugins/images-loaded.js"></script>
    <script src="/user/assets/js/plugins/isotope.js"></script>
    <script src="/user/assets/js/plugins/scrollup.js"></script>
    <script src="/user/assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="/user/assets/js/plugins/jquery.theia.sticky.js"></script>
    <!-- Template  JS -->
    <script src=".//user/assets/js/main.js?v=3.4"></script>
    
  
    <!-- jQuery -->
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->

<!-- Bootstrap JavaScript -->
<!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->

<!-- JavaScript -->
<!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->


<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
       
<!-- Include SweetAlert JS -->

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<!-- <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>